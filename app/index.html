<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>LUMI CORE HOME / LUMINABULIGE</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #0f172a;
      color: #e5e7eb;
    }

    .page {
      max-width: 640px;
      margin: 0 auto;
      padding: 20px 16px 40px;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }

    .logo {
      font-weight: 700;
      letter-spacing: 0.06em;
      font-size: 14px;
    }

    .badge {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid #64748b;
      text-transform: uppercase;
    }

    h2 {
      font-size: 18px;
      margin: 0 0 8px;
    }

    .card {
      border-radius: 12px;
      padding: 16px 14px;
      background: #020617;
      border: 1px solid #1f2937;
      margin-bottom: 16px;
    }

    .label-row {
      display: flex;
      justify-content: space-between;
      font-size: 14px;
      margin-bottom: 4px;
    }

    .label {
      color: #9ca3af;
    }
    .value {
      font-variant-numeric: tabular-nums;
    }

    .subtext {
      font-size: 12px;
      color: #9ca3af;
      margin-top: 8px;
      line-height: 1.5;
    }

    .status-badge {
      display: inline-flex;
      align-items: center;
      font-size: 11px;
      font-weight: 600;
      padding: 3px 8px;
      border-radius: 999px;
      margin-top: 8px;
    }
    .status-safe {
      background: rgba(22, 163, 74, 0.15);
      color: #4ade80;
      border: 1px solid rgba(74, 222, 128, 0.4);
    }
    .status-warning {
      background: rgba(234, 179, 8, 0.12);
      color: #facc15;
      border: 1px solid rgba(250, 204, 21, 0.4);
    }
    .status-danger {
      background: rgba(248, 113, 113, 0.15);
      color: #fca5a5;
      border: 1px solid rgba(248, 113, 113, 0.5);
    }

    .pill {
      display: inline-flex;
      align-items: center;
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid #4b5563;
      margin-bottom: 8px;
      color: #e5e7eb;
    }

    .section-title-row {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 4px;
    }

    .day-label {
      font-size: 12px;
      color: #9ca3af;
    }

    .main-text {
      font-size: 14px;
      line-height: 1.6;
      margin: 4px 0;
    }

    .button-primary {
      display: inline-flex;
      margin-top: 8px;
      padding: 9px 14px;
      border-radius: 999px;
      border: 1px solid #64748b;
      font-size: 13px;
      background: #020617;
      color: #e5e7eb;
      text-decoration: none;
    }

    .button-primary:disabled {
      opacity: 0.4;
    }

    .disclaimer {
      font-size: 11px;
      color: #6b7280;
      margin-top: 6px;
      line-height: 1.4;
    }

    footer {
      margin-top: 12px;
      font-size: 11px;
      color: #6b7280;
    }
  </style>
</head>
<body>
  <div class="page">
    <!-- ヘッダー -->
    <!-- 今日のフロアと残高 -->
    <div class="card">
      <h2>今日のフロアと残高</h2>

      <div class="label-row">
        <span class="label">残高</span>
        <span class="value" id="balance_total">¥320,000</span>
      </div>
      <div class="label-row">
        <span class="label">床</span>
        <span class="value" id="paket_bigzoon">¥300,000</span>
      </div>

      <span id="floor_status" class="status-badge status-safe">
        SAFE：床との余裕は十分あります。
      </span>

      <div class="subtext">
        床を下回ると、来月の固定＋最低生活費が危険になります。
      </div>
    </div>

    <!-- 30日チャレンジカード -->
    <div class="card">
      <div class="section-title-row">
        <h2>30日「床を割らない」チャレンジ</h2>
        <span class="day-label" id="day_in_challenge">7日目</span>
      </div>

      <div class="main-text" id="challenge_message">
        今日は「何もしない」だけで合格です。<br />
        大きな支出を休んで、床との距離をキープする日です。
      </div>
    </div>

    <!-- コンディションカード -->
    <div class="card">
      <h2>今のあなたのコンディション</h2>

      <div class="pill" id="risk_mode">NORMAL</div>

      <div class="main-text" id="risk_message">
        いつもどおりの判断ができる状態です。<br />
        必要な支出の見直しや、小さな調整には向いています。
      </div>
    </div>

    <!-- フッター -->
    <footer>
      LUMI CORE HOME v1.0 / Dummy state for MVP design<br />
      この画面はプロトタイプです。実際のお金は動きません。
    </footer>
  </div> <!-- .page の終わり -->
<script>
  function getMockParam() {
    const params = new URLSearchParams(window.location.search);
    const v = params.get("mock");
    if (v === "warning" || v === "danger" || v === "safe") return v;
    return null;
  }

  function buildHomeStateUrl() {
    const base = "/api/v1/core/home_state";
    const mock = getMockParam();
    if (mock) return base + "?mock=" + encodeURIComponent(mock);
    return base;
  }

  function renderHomeState(s) {
    const bt = document.getElementById("balance_total");
    const pb = document.getElementById("paket_bigzoon");
    if (bt) bt.textContent = "¥" + s.balance_total.toLocaleString();
    if (pb) pb.textContent = "¥" + s.paket_bigzoon.toLocaleString();

    const floorEl = document.getElementById("floor_status");
    if (floorEl) {
      floorEl.classList.remove("status-safe", "status-warning", "status-danger");
      if (s.floor_status === "WARNING") {
        floorEl.classList.add("status-warning");
        floorEl.textContent = "WARNING：床に近づいています。大きな支出には注意してください。";
      } else if (s.floor_status === "DANGER") {
        floorEl.classList.add("status-danger");
        floorEl.textContent = "DANGER：床スレスレです。今日は減速モード推奨です。";
      } else {
        floorEl.classList.add("status-safe");
        floorEl.textContent = "SAFE：床との余裕は十分あります。";
      }
    }

    const dayEl = document.getElementById("day_in_challenge");
    if (dayEl) dayEl.textContent = s.challenge.day_in_challenge + "日目";

    const cm = document.getElementById("challenge_message");
    if (cm) {
      if (s.challenge.is_safe_null_today) {
        cm.innerHTML =
          "今日は「何もしない」だけで合格です。<br />" +
          "大きな支出を休んで、床との距離をキープする日です。";
      } else if (s.challenge.safe_move_limit > 0) {
        cm.innerHTML =
          "今日は「¥" + s.challenge.safe_move_limit.toLocaleString() +
          " まで」なら動かしても床は安全です。<br />" +
          "この金額以内なら、来月の固定＋最低生活費を割り込みません。";
      } else {
        cm.innerHTML =
          "今日は床のすぐ上です。大きな支出はおすすめしません。<br />" +
          "必要最低限の支出だけに抑えると、安全度を保てます。";
      }
    }

    const riskEl = document.getElementById("risk_mode");
    const riskMsgEl = document.getElementById("risk_message");
    if (riskEl) riskEl.textContent = s.heart.risk_mode;

    if (riskMsgEl) {
      if (s.heart.risk_mode === "TIRED") {
        riskMsgEl.innerHTML =
          "少し疲れ気味。大きなお金の判断は控えめに。<br />" +
          "生活の固定部分を優先し、投資やギャンブルは避けましょう。";
      } else if (s.heart.risk_mode === "RED") {
        riskMsgEl.innerHTML =
          "今日は大きな決断はやめておきましょう。<br />" +
          "一度立ち止まり、床との距離が回復してから判断するのがおすすめです。";
      } else {
        riskMsgEl.innerHTML =
          "いつもどおりの判断ができる状態です。<br />" +
          "必要な支出の見直しや、小さな調整には向いています。";
      }
    }
  }

  function loadHomeState() {
    const url = buildHomeStateUrl();
    fetch(url)
      .then(function (res) {
        if (!res.ok) throw new Error("failed to load home_state");
        return res.json();
      })
      .then(function (s) {
        renderHomeState(s);
      })
      .catch(function (e) {
        console.warn("home_state を読み込めませんでした:", e);
      });
  }

  loadHomeState();
</script>
</body>
</html>
