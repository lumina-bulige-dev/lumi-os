(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[838],{2199:function(o,l,e){Promise.resolve().then(e.bind(e,4665))},4665:function(o,l,e){"use strict";e.d(l,{default:function(){return v}});var n=e(7437),i=e(2265),r=e(9376);let t={radius:{sm:10,md:14,lg:18,pill:999},space:{xs:6,sm:10,md:14,lg:18,xl:24,xxl:32},font:{mono:"ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace",ui:"system-ui, -apple-system, BlinkMacSystemFont, Segoe UI, sans-serif"},color:{bg:"#0B1020",card:"#FFFFFF",soft:"#F9FAFB",border:"#E5E7EB",text:"#111827",sub:"#6B7280",weak:"#9CA3AF",ok:"#065F46",okBg:"#ECFDF5",ng:"#9A3412",ngBg:"#FFF7ED",rev:"#7C2D12",revBg:"#FEF2F2",unk:"#1F2937",unkBg:"#F3F4F6",link:"#2563EB"},shadow:{card:"0 14px 40px rgba(0,0,0,0.12)",soft:"0 10px 24px rgba(0,0,0,0.08)"}},d={OK:"署名が一致しました",NG:"署名が一致しませんでした",REVOKED:"発行元が無効化しています",UNKNOWN:"鍵情報が取得できませんでした"};function s(o){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6;return o?o.length<=l+e+3?o:"".concat(o.slice(0,l),"…").concat(o.slice(-e)):""}function a(o){let l=function o(l){if(null==l)return null;if("number"==typeof l){let o=new Date(l<1e12?1e3*l:l);return isNaN(o.getTime())?null:o}if("string"==typeof l){if(/^\d+$/.test(l))return o(Number(l));let e=new Date(l);return isNaN(e.getTime())?null:e}return null}(o);if(!l)return"-";try{return new Intl.DateTimeFormat("ja-JP",{dateStyle:"medium",timeStyle:"short",timeZone:"Asia/Tokyo"}).format(l)}catch(o){return l.toISOString()}}async function c(o){if(o)try{return await navigator.clipboard.writeText(o),!0}catch(l){try{let l=document.createElement("textarea");return l.value=o,l.style.position="fixed",l.style.left="-9999px",document.body.appendChild(l),l.select(),document.execCommand("copy"),document.body.removeChild(l),!0}catch(o){return!1}}}function u(o){var l;let[e,r]=(0,i.useState)(!1),d=!o.value;return(0,n.jsx)("button",{onClick:async()=>{o.value&&await c(o.value)&&(r(!0),setTimeout(()=>r(!1),900))},disabled:d,style:{appearance:"none",border:"1px solid ".concat(t.color.border),background:"#FFFFFF",borderRadius:t.radius.pill,padding:"6px 10px",fontSize:12,fontWeight:800,cursor:d?"not-allowed":"pointer",color:d?t.color.weak:t.color.text},title:o.value?"Copy ".concat(null!==(l=o.label)&&void 0!==l?l:""):"コピー対象がありません",children:e?"Copied":"Copy"})}function p(o){return(0,n.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"180px 1fr auto",gap:10,alignItems:"start"},children:[(0,n.jsx)("div",{style:{color:t.color.sub,fontSize:13,paddingTop:2},children:o.k}),(0,n.jsx)("div",{style:{color:t.color.text},children:o.v}),(0,n.jsx)("div",{children:o.right})]})}function v(){var o,l,e,c,v,g,f,h,x,m,y,b,j,k,F,S,w,N,I,_,E,R,B,C,T,A,W,O,D,z,P,U,G,K,H,M,J,V,L,Q,X,Z,$,q;let Y=(0,r.useSearchParams)(),oo=(0,i.useMemo)(()=>{let o=Y.get("proofId")||void 0,l=Y.get("hash")||void 0;return{proofId:o,hash:l,sig:Y.get("sig")||void 0,kid:Y.get("kid")||void 0,alg:Y.get("alg")||void 0}},[Y]),[ol,oe]=(0,i.useState)(!1),[on,oi]=(0,i.useState)(null),[or,ot]=(0,i.useState)(null),[od,os]=(0,i.useState)(null),oa=(0,i.useMemo)(()=>{if(!(null==on?void 0:on.result))return null;let o=String(on.result).toUpperCase();return"OK"===o||"NG"===o||"REVOKED"===o||"UNKNOWN"===o?o:null},[on]),oc="NG"===oa||"UNKNOWN"===oa,ou=(0,i.useMemo)(()=>window.location.href,[oo.proofId,oo.hash,oo.sig,oo.kid,oo.alg]),op=(0,i.useMemo)(()=>{var o,l,e,n,i,r,t,d,s;if(!on)return"";let c=["Proof Verification Issue","","proofId: ".concat(null!==(o=oo.proofId)&&void 0!==o?o:"-"),"result: ".concat(String(null!==(l=on.result)&&void 0!==l?l:"-")),"error: ".concat(null!==(e=on.error)&&void 0!==e?e:"-"),"verified: ".concat("boolean"==typeof on.verified?String(on.verified):"-"),"verifiedAt(JST): ".concat(od?a(od):"-"),"","page_url: ".concat(ou||"-"),"","kid: ".concat(null!==(i=null!==(n=oo.kid)&&void 0!==n?n:on.kid)&&void 0!==i?i:"-"),"alg: ".concat(null!==(t=null!==(r=oo.alg)&&void 0!==r?r:on.alg)&&void 0!==t?t:"-"),"hash: ".concat(null!==(s=null!==(d=oo.hash)&&void 0!==d?d:on.payload_hash_b64u)&&void 0!==s?s:"-"),"","response_json:",JSON.stringify(on,null,2),"","Please advise next steps."].join("\n");return"mailto:contact@luminabulige.com?subject=".concat(encodeURIComponent("Proof Verification Issue"),"&body=").concat(encodeURIComponent(c))},[on,oo,od,ou]);async function ov(){ot(null),oe(!0);try{let o=new URLSearchParams;oo.proofId&&o.set("proofId",oo.proofId),oo.hash&&o.set("hash",oo.hash),oo.sig&&o.set("sig",oo.sig),oo.kid&&o.set("kid",oo.kid),oo.alg&&o.set("alg",oo.alg);let l=await fetch("/api/verify?".concat(o.toString()),{method:"GET"}),e=await l.json();oi(e),os(Date.now()),l.ok||ot((null==e?void 0:e.error)?"".concat(e.error):"HTTP ".concat(l.status))}catch(o){ot((null==o?void 0:o.message)||String(o)),oi(null),os(Date.now())}finally{oe(!1)}}let og=!!(oo.proofId||oo.hash&&oo.sig&&oo.kid&&oo.alg),of=!!(null==on?void 0:on.proof),oh="boolean"==typeof(null==on?void 0:on.verified);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("style",{children:"\n        @media print {\n          details { display: block !important; }\n          details > summary { display: none !important; }\n          details:not([open]) > *:not(summary) { display: block !important; }\n\n          pre {\n            overflow: visible !important;\n            white-space: pre-wrap !important;\n            word-break: break-word !important;\n          }\n\n          /* PDFに残したいボタンは class で除外する */\n          button:not(.print-keep) { display: none !important; }\n          a { text-decoration: none !important; }\n        }\n      "}),(0,n.jsx)("main",{style:{minHeight:"100vh",background:t.color.bg,padding:t.space.xxl,fontFamily:t.font.ui},children:(0,n.jsxs)("div",{style:{maxWidth:860,margin:"0 auto"},children:[(0,n.jsxs)("div",{style:{marginBottom:t.space.lg},children:[(0,n.jsx)("div",{style:{color:"rgba(255,255,255,0.78)",fontSize:12,letterSpacing:.9},children:"LUMINA BULIGE"}),(0,n.jsx)("h1",{style:{color:"#FFFFFF",margin:"6px 0 0",fontSize:28,lineHeight:1.2},children:"Proof Verification"}),(0,n.jsx)("div",{style:{color:"rgba(255,255,255,0.72)",marginTop:10,fontSize:14,lineHeight:1.7},children:"QR / API の値を用いて署名検証し、結果と根拠を提示します（監査・問い合わせ前提の表示）。"})]}),(0,n.jsxs)("div",{style:{display:"flex",gap:t.space.md,flexWrap:"wrap",marginBottom:t.space.lg,alignItems:"center"},children:[(0,n.jsx)("button",{onClick:ov,disabled:!og||ol,style:{appearance:"none",border:"1px solid ".concat(t.color.border),background:og?"#FFFFFF":"rgba(255,255,255,0.78)",borderRadius:t.radius.md,padding:"11px 14px",fontWeight:900,cursor:og&&!ol?"pointer":"not-allowed",boxShadow:t.shadow.soft,letterSpacing:.2},title:og?"":"proofId または (hash,sig,kid,alg) が必要です",children:ol?"Verifying…":"検証する"}),(0,n.jsx)("div",{style:{color:"rgba(255,255,255,0.72)",fontSize:12,lineHeight:1.6},children:(0,n.jsxs)("div",{style:{fontFamily:t.font.mono},children:["proofId=",oo.proofId?s(oo.proofId,10,6):"-"," / hash=",oo.hash?"yes":"no"," / sig=",oo.sig?"yes":"no"," / kid=",oo.kid?s(oo.kid,10,6):"-"," / alg=",null!==(B=oo.alg)&&void 0!==B?B:"-"]})})]}),(0,n.jsxs)("section",{style:{border:"1px solid rgba(229,231,235,0.9)",borderRadius:t.radius.lg,padding:t.space.xl,background:t.color.card,boxShadow:t.shadow.card},children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",gap:12},children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{style:{fontSize:12,color:t.color.sub,marginBottom:8,letterSpacing:.3},children:"結果"}),oa?(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:10,flexWrap:"wrap"},children:[(0,n.jsx)("span",{style:{...function(o){switch(o){case"OK":return{color:t.color.ok,background:t.color.okBg,border:"1px solid #A7F3D0"};case"NG":return{color:t.color.ng,background:t.color.ngBg,border:"1px solid #FED7AA"};case"REVOKED":return{color:t.color.rev,background:t.color.revBg,border:"1px solid #FECACA"};case"UNKNOWN":return{color:t.color.unk,background:t.color.unkBg,border:"1px solid ".concat(t.color.border)}}}(oa),padding:"6px 10px",borderRadius:t.radius.pill,fontWeight:900,fontSize:12,letterSpacing:.6},children:oa}),(0,n.jsx)("span",{style:{color:t.color.text,fontWeight:900,fontSize:16},children:d[oa]}),oh&&(0,n.jsxs)("span",{style:{marginLeft:6,padding:"6px 10px",borderRadius:t.radius.pill,border:"1px solid ".concat(t.color.border),background:t.color.soft,fontSize:12,fontWeight:900,color:t.color.text},children:["verified: ",String(null==on?void 0:on.verified)]})]}):(0,n.jsx)("div",{style:{color:t.color.sub},children:"まだ検証していません（上の「検証する」を押してください）"}),(0,n.jsx)("div",{style:{marginTop:t.space.sm,display:"flex",gap:10,flexWrap:"wrap"},children:(0,n.jsxs)("div",{style:{color:t.color.sub,fontSize:12},children:["検証時刻（JST）: ",(0,n.jsx)("span",{style:{color:t.color.text,fontWeight:900},children:od?a(od):"-"})]})}),ou&&(0,n.jsx)("div",{style:{marginTop:t.space.sm},children:(0,n.jsx)(p,{k:"verify_url",v:(0,n.jsx)("span",{style:{fontFamily:t.font.mono},children:s(ou,42,14)}),right:(0,n.jsx)(u,{value:ou,label:"verify_url"})})}),or&&(0,n.jsxs)("div",{style:{marginTop:t.space.md,background:t.color.soft,border:"1px solid ".concat(t.color.border),borderRadius:t.radius.md,padding:t.space.md,color:t.color.text},children:[(0,n.jsx)("div",{style:{fontWeight:900,marginBottom:6},children:"エラー"}),(0,n.jsx)("div",{style:{fontFamily:t.font.mono,fontSize:12,whiteSpace:"pre-wrap"},children:or})]})]}),oc&&on&&(0,n.jsx)("div",{style:{marginTop:10,marginBottom:10,color:t.color.sub,fontSize:12,lineHeight:1.6},children:"問い合わせボタンを押すと、検証に必要な情報（proofId / hash / kid / alg / 結果 / 応答JSON）が本文に自動で入ります。"}),oc&&on&&(0,n.jsx)("a",{href:op,style:{display:"inline-flex",alignItems:"center",justifyContent:"center",gap:8,padding:"10px 12px",borderRadius:t.radius.md,border:"1px solid ".concat(t.color.border),background:"#FFFFFF",color:t.color.link,fontWeight:900,textDecoration:"none",whiteSpace:"nowrap"},children:"発行元に問い合わせ"})]}),(0,n.jsxs)("div",{style:{marginTop:t.space.xl},children:[(0,n.jsx)("div",{style:{fontSize:12,color:t.color.sub,marginBottom:t.space.sm,letterSpacing:.3},children:"Proof 情報"}),(0,n.jsx)("div",{style:{background:t.color.soft,border:"1px solid ".concat(t.color.border),borderRadius:t.radius.md,padding:t.space.lg},children:of?(0,n.jsxs)("div",{style:{display:"grid",gap:10},children:[(0,n.jsx)(p,{k:"proof_id",v:(0,n.jsx)("span",{style:{fontFamily:t.font.mono},children:null!==(C=null==on?void 0:null===(o=on.proof)||void 0===o?void 0:o.proof_id)&&void 0!==C?C:"-"}),right:(0,n.jsx)(u,{value:null!==(T=null==on?void 0:null===(l=on.proof)||void 0===l?void 0:l.proof_id)&&void 0!==T?T:null,label:"proof_id"})}),(0,n.jsx)(p,{k:"期間",v:(0,n.jsxs)("span",{children:[null!==(A=null==on?void 0:null===(c=on.proof)||void 0===c?void 0:null===(e=c.range)||void 0===e?void 0:e.from)&&void 0!==A?A:"-"," 〜 ",null!==(W=null==on?void 0:null===(g=on.proof)||void 0===g?void 0:null===(v=g.range)||void 0===v?void 0:v.to)&&void 0!==W?W:"-"]})}),(0,n.jsx)(p,{k:"作成",v:(0,n.jsx)("span",{children:a(null==on?void 0:null===(f=on.proof)||void 0===f?void 0:f.created_at_ts)})}),(0,n.jsx)(p,{k:"カウント",v:(0,n.jsxs)("span",{children:["SAFE ",null!==(O=null==on?void 0:null===(x=on.proof)||void 0===x?void 0:null===(h=x.counts)||void 0===h?void 0:h.SAFE)&&void 0!==O?O:0," / WARNING ",null!==(D=null==on?void 0:null===(y=on.proof)||void 0===y?void 0:null===(m=y.counts)||void 0===m?void 0:m.WARNING)&&void 0!==D?D:0," / DANGER"," ",null!==(z=null==on?void 0:null===(j=on.proof)||void 0===j?void 0:null===(b=j.counts)||void 0===b?void 0:b.DANGER)&&void 0!==z?z:0," / total ",null!==(P=null==on?void 0:null===(F=on.proof)||void 0===F?void 0:null===(k=F.counts)||void 0===k?void 0:k.total)&&void 0!==P?P:0]})}),(0,n.jsx)(p,{k:"ruleset_version",v:(0,n.jsx)("span",{style:{fontFamily:t.font.mono},children:null!==(U=null==on?void 0:null===(S=on.proof)||void 0===S?void 0:S.ruleset_version)&&void 0!==U?U:"-"})}),(0,n.jsx)(p,{k:"kid",v:(0,n.jsx)("span",{style:{fontFamily:t.font.mono},children:null!==(K=null!==(G=null==on?void 0:null===(w=on.proof)||void 0===w?void 0:w.kid)&&void 0!==G?G:null==on?void 0:on.kid)&&void 0!==K?K:"-"}),right:(0,n.jsx)(u,{value:null!==(M=null!==(H=null==on?void 0:null===(N=on.proof)||void 0===N?void 0:N.kid)&&void 0!==H?H:null==on?void 0:on.kid)&&void 0!==M?M:null,label:"kid"})}),(0,n.jsx)(p,{k:"alg",v:(0,n.jsx)("span",{style:{fontFamily:t.font.mono},children:null!==(V=null!==(J=null==on?void 0:null===(I=on.proof)||void 0===I?void 0:I.alg)&&void 0!==J?J:null==on?void 0:on.alg)&&void 0!==V?V:"-"}),right:(0,n.jsx)(u,{value:null!==(Q=null!==(L=null==on?void 0:null===(_=on.proof)||void 0===_?void 0:_.alg)&&void 0!==L?L:null==on?void 0:on.alg)&&void 0!==Q?Q:null,label:"alg"})}),(0,n.jsx)(p,{k:"payload_hash_b64u",v:(0,n.jsx)("span",{style:{fontFamily:t.font.mono},children:null!==(Z=null!==(X=null==on?void 0:null===(E=on.proof)||void 0===E?void 0:E.payload_hash_b64u)&&void 0!==X?X:null==on?void 0:on.payload_hash_b64u)&&void 0!==Z?Z:"-"}),right:(0,n.jsx)(u,{value:null!==(q=null!==($=null==on?void 0:null===(R=on.proof)||void 0===R?void 0:R.payload_hash_b64u)&&void 0!==$?$:null==on?void 0:on.payload_hash_b64u)&&void 0!==q?q:null,label:"payload_hash_b64u"})})]}):(0,n.jsxs)("div",{style:{color:t.color.sub,lineHeight:1.7},children:["Proof 情報が取得できませんでした。",(0,n.jsx)("br",{}),(0,n.jsx)("span",{style:{color:t.color.weak},children:"proofId 付きURLでの検証が最短で確実です（例: /v?proofId=xxxx）"})]})})]}),on&&(0,n.jsx)("div",{style:{marginTop:t.space.lg},children:(0,n.jsxs)("details",{children:[(0,n.jsx)("summary",{style:{cursor:"pointer",color:t.color.link,fontWeight:900},children:"技術詳細（レスポンスJSON）"}),(0,n.jsx)("pre",{style:{marginTop:t.space.sm,padding:t.space.md,borderRadius:t.radius.md,border:"1px solid ".concat(t.color.border),background:"#0F172A",color:"#E5E7EB",overflowX:"auto",fontSize:12,lineHeight:1.5},children:JSON.stringify(on,null,2)})]})})]}),(0,n.jsxs)("div",{style:{color:"rgba(255,255,255,0.62)",fontSize:12,marginTop:t.space.lg,lineHeight:1.7},children:["注意: NG / UNKNOWN の場合は、入力値の転記ミス、改ざん、鍵ローテーション等が原因になり得ます。",(0,n.jsx)("br",{}),"ここまで整ってると、言い訳じゃなくて「説明」になります（大事）。"]})]})})]})}},9376:function(o,l,e){"use strict";var n=e(5475);e.o(n,"useRouter")&&e.d(l,{useRouter:function(){return n.useRouter}}),e.o(n,"useSearchParams")&&e.d(l,{useSearchParams:function(){return n.useSearchParams}})}},function(o){o.O(0,[971,117,744],function(){return o(o.s=2199)}),_N_E=o.O()}]);