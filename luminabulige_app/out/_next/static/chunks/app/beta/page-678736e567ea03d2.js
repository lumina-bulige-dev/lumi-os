(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[568],{5592:function(e,t,n){Promise.resolve().then(n.bind(n,5639))},5639:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return u}});var a=n(7437),r=n(2265),l=n(9067),i=n(2904);function c(e){let t="";for(let n of e)t+=String.fromCharCode(n);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"")}async function o(e){let t=new ArrayBuffer(e.byteLength);return new Uint8Array(t).set(e),new Uint8Array(await crypto.subtle.digest("SHA-256",t))}async function s(e){var t;let n=JSON.stringify(e),a=new TextEncoder().encode(n),r=c(a),i=c(await o(a)),s=await fetch("/api/sign",{method:"POST",headers:{"Content-Type":"application/json"},cache:"no-store",body:JSON.stringify({hashB64u:i})});if(!s.ok)throw Error("sign api failed: ".concat(s.status));let{sigB64u:u,kid:f,alg:d,ts:m}=await s.json(),g=await l.PDFDocument.create(),h=g.addPage([595,842]),N=await g.embedFont(l.StandardFonts.Helvetica),p=["LUMI 30-day log (Verified)","","alg: ".concat(d,"  kid: ").concat(f),"ts: ".concat(m),"","hashB64u: ".concat(i),"sigB64u : ".concat(u),"","payloadB64u:",r],b=800;for(let e of p)if(h.drawText(e.slice(0,110),{x:40,y:b,size:10,font:N}),(b-=14)<40)break;let y=await g.save(),v="lumi_verified_".concat((null==e?void 0:null===(t=e.range)||void 0===t?void 0:t.to)||"log",".pdf"),w=new ArrayBuffer(y.byteLength);return new Uint8Array(w).set(y),{file:new File([w],v,{type:"application/pdf"}),fileName:v,meta:{hashB64u:i,sigB64u:u,kid:f,alg:d,ts:m}}}function u(){let[e,t]=(0,r.useState)([]),[n,l]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let e=(0,i.T5)();t((0,i.ZK)(e))},[]);let c=(0,r.useMemo)(()=>(0,i.Iz)(e),[e]),o=(0,r.useMemo)(()=>(function(){let e=new Date,t=e.toISOString().slice(0,10),n=new Date(e);return n.setDate(e.getDate()-29),{from:n.toISOString().slice(0,10),to:t}})(),[]),u=(0,r.useCallback)(async()=>{if(!n){l(!0);try{let t={share_to_label:"manual",range:o,counts:{SAFE:c.safe,WARNING:c.warning,DANGER:c.danger},logs:e,url:window.location.href},{file:n,fileName:a}=await s(t);try{let e=navigator;if(e.share&&(!e.canShare||e.canShare({files:[n]}))){await e.share({title:"LUMI 30-day log (Verified)",text:"Range: ".concat(o.from,"..").concat(o.to,"\nSAFE:").concat(c.safe," / WARNING:").concat(c.warning," / DANGER:").concat(c.danger),files:[n]});return}}catch(e){}!function(e,t){let n=URL.createObjectURL(e),a=document.createElement("a");a.href=n,a.download=t,a.click(),URL.revokeObjectURL(n)}(n,a)}catch(e){console.error("PDF_SHARE_FAILED",e),alert("PDF生成に失敗: ".concat((null==e?void 0:e.message)||e))}finally{setTimeout(()=>l(!1),400)}}},[n,e,o,c.safe,c.warning,c.danger]);return(0,a.jsx)("main",{className:"beta",children:(0,a.jsxs)("div",{className:"page",children:[(0,a.jsx)("h1",{className:"h1",children:"30日ログ（β）"}),(0,a.jsx)("div",{className:"lead",children:"Compareで「今日のログとして保存」を押すと、ここに集計が反映されます。"}),(0,a.jsxs)("div",{className:"card",children:[(0,a.jsx)("div",{className:"summary-title",children:"30日のまとめ（直近30日）"}),(0,a.jsxs)("div",{className:"pill-row",children:[(0,a.jsxs)("div",{className:"pill safe",children:["SAFE : ",c.safe,"日"]}),(0,a.jsxs)("div",{className:"pill warn",children:["WARNING : ",c.warning,"日"]}),(0,a.jsxs)("div",{className:"pill danger",children:["DANGER : ",c.danger,"日"]})]}),(0,a.jsxs)("div",{className:"note",children:["SAFE:",c.safe," / WARNING:",c.warning," / DANGER:",c.danger,"（記録:",c.total,"）"]}),(0,a.jsx)("div",{style:{marginTop:12},children:(0,a.jsx)("button",{className:"btn",type:"button",onClick:u,children:n?"PDFを生成中…":"Verified PDF を作る"})}),(0,a.jsx)("div",{className:"note",children:"※ 銀行ではありません／資金は預かりません／投資助言はしません"})]}),(0,a.jsxs)("div",{className:"card",children:[(0,a.jsx)("div",{className:"summary-title",children:"ログ一覧"}),(0,a.jsx)("ul",{children:e.map(e=>(0,a.jsxs)("li",{children:[e.date," / ",e.level," / ",Number(e.diffYen).toLocaleString(),"円"]},e.date))}),(0,a.jsx)("div",{style:{marginTop:14},children:(0,a.jsx)("a",{href:"/compare",children:"Compareへ戻る"})})]})]})})}},9856:function(e,t,n){"use strict";function a(e,t){return e>=1.2*t?"SAFE":e>=t?"WARNING":"DANGER"}n.d(t,{N:function(){return a}})},2904:function(e,t,n){"use strict";n.d(t,{AH:function(){return s},FB:function(){return c},Iz:function(){return f},Oz:function(){return i},T5:function(){return o},ZK:function(){return u}});var a=n(9856);let r="lumi:compare:v1",l="lumi:dailyLogs:v1";function i(){let e=d(r);if(e&&"number"==typeof e.balance&&"number"==typeof e.floor)return{balance:e.balance,floor:e.floor};let t=d("lumi_compare_v1");return t&&"number"==typeof t.balance&&"number"==typeof t.floor?(c(t.balance,t.floor),{balance:t.balance,floor:t.floor}):{balance:0,floor:0}}function c(e,t){localStorage.setItem(r,JSON.stringify({balance:e,floor:t}))}function o(){let e=d(l);return e&&Array.isArray(e)?e.filter(m):[]}function s(e,t){let n=Number(e),r=Number(t);if(!Number.isFinite(n)||!Number.isFinite(r))throw Error("Invalid balance/floor");let i=function(){let e=new Date,t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(n,"-").concat(a)}(),c=(0,a.N)(n,r),s=n-r,u=o(),f={date:i,balanceYen:n,floorYen:r,level:c,diffYen:s},d=[f,...u.filter(e=>e.date!==i)].sort((e,t)=>e.date<t.date?1:-1).slice(0,30);return localStorage.setItem(l,JSON.stringify(d)),f}function u(e){let t=new Date;t.setDate(t.getDate()-29);let n=t.toISOString().slice(0,10);return e.filter(e=>e.date>=n).sort((e,t)=>e.date<t.date?1:-1)}function f(e){return{safe:e.filter(e=>"SAFE"===e.level).length,warning:e.filter(e=>"WARNING"===e.level).length,danger:e.filter(e=>"DANGER"===e.level).length,total:e.length}}function d(e){try{let t=localStorage.getItem(e);if(!t)return null;return JSON.parse(t)}catch(e){return null}}function m(e){return e&&"string"==typeof e.date&&"number"==typeof e.balanceYen&&"number"==typeof e.floorYen&&("SAFE"===e.level||"WARNING"===e.level||"DANGER"===e.level)&&"number"==typeof e.diffYen}}},function(e){e.O(0,[323,971,117,744],function(){return e(e.s=5592)}),_N_E=e.O()}]);