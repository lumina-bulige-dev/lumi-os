(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[838],{2199:function(o,l,i){Promise.resolve().then(i.bind(i,4665))},4665:function(o,l,i){"use strict";i.d(l,{default:function(){return h}});var n=i(7437),e=i(29),r=i.n(e),t=i(2265),d=i(9376);let a={radius:{sm:10,md:14,lg:18,pill:999},space:{xs:6,sm:10,md:14,lg:18,xl:24,xxl:32},font:{mono:"ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace",ui:"system-ui, -apple-system, BlinkMacSystemFont, Segoe UI, sans-serif"},color:{bg:"#0B1020",card:"#FFFFFF",soft:"#F9FAFB",border:"#E5E7EB",text:"#111827",sub:"#6B7280",weak:"#9CA3AF",ok:"#065F46",okBg:"#ECFDF5",ng:"#9A3412",ngBg:"#FFF7ED",rev:"#7C2D12",revBg:"#FEF2F2",unk:"#1F2937",unkBg:"#F3F4F6",link:"#2563EB"},shadow:{card:"0 14px 40px rgba(0,0,0,0.12)",soft:"0 10px 24px rgba(0,0,0,0.08)"}},s={OK:"署名が一致しました",NG:"署名が一致しませんでした",REVOKED:"発行元が無効化しています",UNKNOWN:"鍵情報が取得できませんでした"};function c(o){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6;return o?o.length<=l+i+3?o:"".concat(o.slice(0,l),"…").concat(o.slice(-i)):""}function u(o){let l=function o(l){if(null==l)return null;if("number"==typeof l){let o=new Date(l<1e12?1e3*l:l);return isNaN(o.getTime())?null:o}if("string"==typeof l){if(/^\d+$/.test(l))return o(Number(l));let i=new Date(l);return isNaN(i.getTime())?null:i}return null}(o);if(!l)return"-";try{return new Intl.DateTimeFormat("ja-JP",{dateStyle:"medium",timeStyle:"short",timeZone:"Asia/Tokyo"}).format(l)}catch(o){return l.toISOString()}}async function p(o){if(o)try{return await navigator.clipboard.writeText(o),!0}catch(l){try{let l=document.createElement("textarea");return l.value=o,l.style.position="fixed",l.style.left="-9999px",document.body.appendChild(l),l.select(),document.execCommand("copy"),document.body.removeChild(l),!0}catch(o){return!1}}}function v(o){var l;let[i,e]=(0,t.useState)(!1),r=!o.value;return(0,n.jsx)("button",{onClick:async()=>{o.value&&await p(o.value)&&(e(!0),setTimeout(()=>e(!1),900))},disabled:r,style:{appearance:"none",border:"1px solid ".concat(a.color.border),background:"#FFFFFF",borderRadius:a.radius.pill,padding:"6px 10px",fontSize:12,fontWeight:800,cursor:r?"not-allowed":"pointer",color:r?a.color.weak:a.color.text},title:o.value?"Copy ".concat(null!==(l=o.label)&&void 0!==l?l:""):"コピー対象がありません",children:i?"Copied":"Copy"})}function g(o){return(0,n.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"180px 1fr auto",gap:10,alignItems:"start"},children:[(0,n.jsx)("div",{style:{color:a.color.sub,fontSize:13,paddingTop:2},children:o.k}),(0,n.jsx)("div",{style:{color:a.color.text},children:o.v}),(0,n.jsx)("div",{children:o.right})]})}function f(){return(0,n.jsx)(r(),{id:"123c5ae6c22fb3d3",children:'@page{size:A4;margin:10mm}@media print{html,body{background:#fff!important}main{background:#fff!important;padding:0!important;min-height:auto!important}*{-webkit-print-color-adjust:exact;color-adjust:exact;print-color-adjust:exact}button{display:none!important}.print-one h1{font-size:18px!important;margin:0 0 6px!important}.print-one section{-webkit-box-shadow:none!important;-moz-box-shadow:none!important;box-shadow:none!important;padding:10px!important}.print-one *{line-height:1.25!important}.print-one [data-print="json"]{display:none!important}.print-one [data-print="note"]{display:none!important}.print-one section,.print-one div{-webkit-column-break-inside:avoid;break-inside:avoid;page-break-inside:avoid}.print-one pre,.print-one code,.print-one .mono{white-space:pre-wrap!important;word-break:break-word!important;overflow:visible!important}}'})}function h(){var o,l,i,e,r,p,h,m,x,b,y,j,k,F,S,w,N,_,I,E,R,T,B,C,W,A,O,z,D,P,U,K,G,H,M,L,V,J,Q,X,Z,$,q,Y,oo,ol,oi,on,oe,or,ot,od;let oa=(0,d.useSearchParams)(),os=(0,t.useMemo)(()=>{let o=oa.get("proofId")||void 0,l=oa.get("hash")||void 0;return{proofId:o,hash:l,sig:oa.get("sig")||void 0,kid:oa.get("kid")||void 0,alg:oa.get("alg")||void 0}},[oa]),[oc,ou]=(0,t.useState)(!1),[op,ov]=(0,t.useState)(null),[og,of]=(0,t.useState)(null),[oh,om]=(0,t.useState)(null),ox=(0,t.useMemo)(()=>{if(!(null==op?void 0:op.result))return null;let o=String(op.result).toUpperCase();return"OK"===o||"NG"===o||"REVOKED"===o||"UNKNOWN"===o?o:null},[op]),ob=(0,t.useMemo)(()=>op&&ox?"NG"===ox&&os.proofId?"proofId は存在しますが署名が一致しません。URL改ざん、転記ミス、または署名不一致の可能性があります。":"NG"!==ox||os.proofId?"UNKNOWN"===ox?"kid に対応する公開鍵が取得できません。発行元側の鍵ローテーション、または入力値の不整合の可能性があります。":"REVOKED"===ox?"この Proof は発行元により無効化されています（検証自体は実施済みとして扱います）。":"OK"===ox?"検証は成功しました。表示される Proof 情報は発行元DB（または一致した記録）に基づきます。":null:"署名が一致しません。入力値（hash / sig / kid / alg）の転記ミスや改ざんの可能性があります。":null,[op,ox,os.proofId]),oy="NG"===ox||"UNKNOWN"===ox,oj=(0,t.useMemo)(()=>window.location.href,[os.proofId,os.hash,os.sig,os.kid,os.alg]),ok=(0,t.useMemo)(()=>{var o,l,i,n,e,r,t,d,a;if(!op)return"";let s=["Proof Verification Issue","","proofId: ".concat(null!==(o=os.proofId)&&void 0!==o?o:"-"),"result: ".concat(String(null!==(l=op.result)&&void 0!==l?l:"-")),"error: ".concat(null!==(i=op.error)&&void 0!==i?i:"-"),"verified: ".concat("boolean"==typeof op.verified?String(op.verified):"-"),"verifiedAt(JST): ".concat(oh?u(oh):"-"),"","page_url: ".concat(oj||"-"),"","kid: ".concat(null!==(e=null!==(n=os.kid)&&void 0!==n?n:op.kid)&&void 0!==e?e:"-"),"alg: ".concat(null!==(t=null!==(r=os.alg)&&void 0!==r?r:op.alg)&&void 0!==t?t:"-"),"hash: ".concat(null!==(a=null!==(d=os.hash)&&void 0!==d?d:op.payload_hash_b64u)&&void 0!==a?a:"-"),"","response_json:",JSON.stringify(op,null,2),"","Please advise next steps."].join("\n");return"mailto:contact@luminabulige.com?subject=".concat(encodeURIComponent("Proof Verification Issue"),"&body=").concat(encodeURIComponent(s))},[op,os,oh,oj]);async function oF(){of(null),ou(!0);try{let o=new URLSearchParams;os.proofId&&o.set("proofId",os.proofId),os.hash&&o.set("hash",os.hash),os.sig&&o.set("sig",os.sig),os.kid&&o.set("kid",os.kid),os.alg&&o.set("alg",os.alg);let l=await fetch("/api/verify?".concat(o.toString()),{method:"GET"}),i=await l.json();ov(i),om(Date.now()),l.ok||of((null==i?void 0:i.error)?"".concat(i.error):"HTTP ".concat(l.status))}catch(o){of((null==o?void 0:o.message)||String(o)),ov(null),om(Date.now())}finally{ou(!1)}}let oS=!!(os.proofId||os.hash&&os.sig&&os.kid&&os.alg),ow=!!(null==op?void 0:op.proof),oN="boolean"==typeof(null==op?void 0:op.verified),[o_,oI]=(0,t.useState)(!1);return(0,t.useEffect)(()=>{let o=()=>oI(!1);return window.addEventListener("afterprint",o),()=>window.removeEventListener("afterprint",o)},[]),(0,n.jsxs)(t.Fragment,{children:[(0,n.jsx)(f,{}),(0,n.jsx)("main",{className:o_?"print-one":"",style:{minHeight:"100vh",background:a.color.bg,padding:a.space.xxl,fontFamily:a.font.ui},children:(0,n.jsxs)("div",{style:{maxWidth:860,margin:"0 auto"},children:[(0,n.jsxs)("div",{style:{marginBottom:a.space.lg},children:[(0,n.jsx)("div",{style:{color:"rgba(255,255,255,0.78)",fontSize:12,letterSpacing:.9},children:"LUMINA BULIGE"}),(0,n.jsx)("h1",{style:{color:"#FFFFFF",margin:"6px 0 0",fontSize:28,lineHeight:1.2},children:"Proof Verification"}),(0,n.jsx)("div",{style:{color:"rgba(255,255,255,0.72)",marginTop:10,fontSize:14,lineHeight:1.7},children:"QR / API の値を用いて署名検証し、結果と根拠を提示します（監査・問い合わせ前提の表示）。"})]}),(0,n.jsxs)("div",{style:{display:"flex",gap:a.space.md,flexWrap:"wrap",marginBottom:a.space.lg,alignItems:"center"},children:[(0,n.jsx)("button",{onClick:oF,disabled:!oS||oc,style:{appearance:"none",border:"1px solid ".concat(a.color.border),background:oS?"#FFFFFF":"rgba(255,255,255,0.78)",borderRadius:a.radius.md,padding:"11px 14px",fontWeight:900,cursor:oS&&!oc?"pointer":"not-allowed",boxShadow:a.shadow.soft,letterSpacing:.2},title:oS?"":"proofId または (hash,sig,kid,alg) が必要です",children:oc?"Verifying…":"検証する"}),(0,n.jsx)("button",{onClick:()=>{oI(!0),setTimeout(()=>window.print(),60)},style:{appearance:"none",border:"1px solid ".concat(a.color.border),background:"#FFFFFF",borderRadius:a.radius.md,padding:"11px 14px",fontWeight:900,cursor:"pointer",boxShadow:a.shadow.soft},title:"1ページに収まるように要点だけで印刷します",children:"1枚PDF"}),(0,n.jsx)("div",{style:{color:"rgba(255,255,255,0.72)",fontSize:12,lineHeight:1.6},children:(0,n.jsxs)("div",{style:{fontFamily:a.font.mono},children:["proofId=",os.proofId?c(os.proofId,10,6):"-"," / hash=",os.hash?"yes":"no"," / sig=",os.sig?"yes":"no"," / kid=",os.kid?c(os.kid,10,6):"-"," / alg=",null!==(A=os.alg)&&void 0!==A?A:"-"]})})]}),(0,n.jsxs)("section",{style:{border:"1px solid rgba(229,231,235,0.9)",borderRadius:a.radius.lg,padding:a.space.xl,background:a.color.card,boxShadow:a.shadow.card},children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",gap:12},children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{style:{fontSize:12,color:a.color.sub,marginBottom:8,letterSpacing:.3},children:"結果"}),ox?(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:10,flexWrap:"wrap"},children:[(0,n.jsx)("span",{style:{...function(o){switch(o){case"OK":return{color:a.color.ok,background:a.color.okBg,border:"1px solid #A7F3D0"};case"NG":return{color:a.color.ng,background:a.color.ngBg,border:"1px solid #FED7AA"};case"REVOKED":return{color:a.color.rev,background:a.color.revBg,border:"1px solid #FECACA"};case"UNKNOWN":return{color:a.color.unk,background:a.color.unkBg,border:"1px solid ".concat(a.color.border)}}}(ox),padding:"6px 10px",borderRadius:a.radius.pill,fontWeight:900,fontSize:12,letterSpacing:.6},children:ox}),(0,n.jsx)("span",{style:{color:a.color.text,fontWeight:900,fontSize:16},children:s[ox]}),oN&&(0,n.jsxs)("span",{style:{marginLeft:6,padding:"6px 10px",borderRadius:a.radius.pill,border:"1px solid ".concat(a.color.border),background:a.color.soft,fontSize:12,fontWeight:900,color:a.color.text},children:["verified: ",String(null==op?void 0:op.verified)]})]}):(0,n.jsx)("div",{style:{color:a.color.sub},children:"まだ検証していません（上の「検証する」を押してください）"}),(0,n.jsx)("div",{style:{marginTop:a.space.sm,display:"flex",gap:10,flexWrap:"wrap"},children:(0,n.jsxs)("div",{style:{color:a.color.sub,fontSize:12},children:["検証時刻（JST）:"," ",(0,n.jsx)("span",{style:{color:a.color.text,fontWeight:900},children:oh?u(oh):"-"})]})}),oj&&(0,n.jsx)("div",{style:{marginTop:a.space.sm},children:(0,n.jsx)(g,{k:"verify_url",v:(0,n.jsx)("span",{className:"mono",style:{fontFamily:a.font.mono},children:c(oj,42,14)}),right:(0,n.jsx)(v,{value:oj,label:"verify_url"})})}),ob&&(0,n.jsx)("div",{style:{marginTop:a.space.sm,color:a.color.sub,lineHeight:1.7},children:ob}),og&&(0,n.jsxs)("div",{style:{marginTop:a.space.md,background:a.color.soft,border:"1px solid ".concat(a.color.border),borderRadius:a.radius.md,padding:a.space.md,color:a.color.text},children:[(0,n.jsx)("div",{style:{fontWeight:900,marginBottom:6},children:"エラー"}),(0,n.jsx)("div",{style:{fontFamily:a.font.mono,fontSize:12,whiteSpace:"pre-wrap"},children:og})]})]}),oy&&op&&(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{style:{marginTop:10,marginBottom:10,color:a.color.sub,fontSize:12,lineHeight:1.6},children:"問い合わせボタンを押すと、検証に必要な情報（proofId / hash / kid / alg / 結果 / 応答JSON）が本文に自動で入ります。"}),(0,n.jsx)("a",{href:ok,style:{display:"inline-flex",alignItems:"center",justifyContent:"center",gap:8,padding:"10px 12px",borderRadius:a.radius.md,border:"1px solid ".concat(a.color.border),background:"#FFFFFF",color:a.color.link,fontWeight:900,textDecoration:"none",whiteSpace:"nowrap"},children:"発行元に問い合わせ"})]})]}),(0,n.jsxs)("div",{"data-print":"proof",style:{marginTop:a.space.xl},children:[(0,n.jsx)("div",{style:{fontSize:12,color:a.color.sub,marginBottom:a.space.sm,letterSpacing:.3},children:"Proof 情報"}),(0,n.jsx)("div",{style:{background:a.color.soft,border:"1px solid ".concat(a.color.border),borderRadius:a.radius.md,padding:a.space.lg},children:ow?(0,n.jsxs)("div",{style:{display:"grid",gap:10},children:[(0,n.jsx)(g,{k:"proof_id",v:(0,n.jsx)("span",{className:"mono",style:{fontFamily:a.font.mono},title:null!==(O=null==op?void 0:null===(o=op.proof)||void 0===o?void 0:o.proof_id)&&void 0!==O?O:"",children:c(null!==(z=null==op?void 0:null===(l=op.proof)||void 0===l?void 0:l.proof_id)&&void 0!==z?z:"-",18,10)}),right:(0,n.jsx)(v,{value:null!==(D=null==op?void 0:null===(i=op.proof)||void 0===i?void 0:i.proof_id)&&void 0!==D?D:null,label:"proof_id"})}),(0,n.jsx)(g,{k:"期間",v:(0,n.jsxs)("span",{children:[null!==(P=null==op?void 0:null===(r=op.proof)||void 0===r?void 0:null===(e=r.range)||void 0===e?void 0:e.from)&&void 0!==P?P:"-"," 〜 ",null!==(U=null==op?void 0:null===(h=op.proof)||void 0===h?void 0:null===(p=h.range)||void 0===p?void 0:p.to)&&void 0!==U?U:"-"]})}),(0,n.jsx)(g,{k:"作成",v:(0,n.jsx)("span",{children:u(null==op?void 0:null===(m=op.proof)||void 0===m?void 0:m.created_at_ts)})}),(0,n.jsx)(g,{k:"カウント",v:(0,n.jsxs)("span",{children:["SAFE ",null!==(K=null==op?void 0:null===(b=op.proof)||void 0===b?void 0:null===(x=b.counts)||void 0===x?void 0:x.SAFE)&&void 0!==K?K:0," / WARNING ",null!==(G=null==op?void 0:null===(j=op.proof)||void 0===j?void 0:null===(y=j.counts)||void 0===y?void 0:y.WARNING)&&void 0!==G?G:0," / DANGER ",null!==(H=null==op?void 0:null===(F=op.proof)||void 0===F?void 0:null===(k=F.counts)||void 0===k?void 0:k.DANGER)&&void 0!==H?H:0," / total ",null!==(M=null==op?void 0:null===(w=op.proof)||void 0===w?void 0:null===(S=w.counts)||void 0===S?void 0:S.total)&&void 0!==M?M:0]})}),(0,n.jsx)(g,{k:"ruleset_version",v:(0,n.jsx)("span",{className:"mono",style:{fontFamily:a.font.mono},children:null!==(L=null==op?void 0:null===(N=op.proof)||void 0===N?void 0:N.ruleset_version)&&void 0!==L?L:"-"})}),(0,n.jsx)(g,{k:"kid",v:(0,n.jsx)("span",{className:"mono",style:{fontFamily:a.font.mono},title:null!==(J=null!==(V=null==op?void 0:null===(_=op.proof)||void 0===_?void 0:_.kid)&&void 0!==V?V:null==op?void 0:op.kid)&&void 0!==J?J:"",children:c(null!==(X=null!==(Q=null==op?void 0:null===(I=op.proof)||void 0===I?void 0:I.kid)&&void 0!==Q?Q:null==op?void 0:op.kid)&&void 0!==X?X:"-",18,10)}),right:(0,n.jsx)(v,{value:null!==($=null!==(Z=null==op?void 0:null===(E=op.proof)||void 0===E?void 0:E.kid)&&void 0!==Z?Z:null==op?void 0:op.kid)&&void 0!==$?$:null,label:"kid"})}),(0,n.jsx)(g,{k:"alg",v:(0,n.jsx)("span",{className:"mono",style:{fontFamily:a.font.mono},children:null!==(Y=null!==(q=null==op?void 0:null===(R=op.proof)||void 0===R?void 0:R.alg)&&void 0!==q?q:null==op?void 0:op.alg)&&void 0!==Y?Y:"-"}),right:(0,n.jsx)(v,{value:null!==(ol=null!==(oo=null==op?void 0:null===(T=op.proof)||void 0===T?void 0:T.alg)&&void 0!==oo?oo:null==op?void 0:op.alg)&&void 0!==ol?ol:null,label:"alg"})}),(0,n.jsx)(g,{k:"payload_hash_b64u",v:(0,n.jsx)("span",{className:"mono",style:{fontFamily:a.font.mono},title:null!==(on=null!==(oi=null==op?void 0:null===(B=op.proof)||void 0===B?void 0:B.payload_hash_b64u)&&void 0!==oi?oi:null==op?void 0:op.payload_hash_b64u)&&void 0!==on?on:"",children:c(null!==(or=null!==(oe=null==op?void 0:null===(C=op.proof)||void 0===C?void 0:C.payload_hash_b64u)&&void 0!==oe?oe:null==op?void 0:op.payload_hash_b64u)&&void 0!==or?or:"-",22,12)}),right:(0,n.jsx)(v,{value:null!==(od=null!==(ot=null==op?void 0:null===(W=op.proof)||void 0===W?void 0:W.payload_hash_b64u)&&void 0!==ot?ot:null==op?void 0:op.payload_hash_b64u)&&void 0!==od?od:null,label:"payload_hash_b64u"})})]}):(0,n.jsxs)("div",{style:{color:a.color.sub,lineHeight:1.7},children:["Proof 情報が取得できませんでした。",(0,n.jsx)("br",{}),(0,n.jsx)("span",{style:{color:a.color.weak},children:"proofId 付きURLでの検証が最短で確実です（例: /v?proofId=xxxx）"})]})})]}),op&&(0,n.jsx)("div",{"data-print":"json",style:{marginTop:a.space.lg},children:(0,n.jsxs)("details",{children:[(0,n.jsx)("summary",{style:{cursor:"pointer",color:a.color.link,fontWeight:900},children:"技術詳細（レスポンスJSON）"}),(0,n.jsx)("pre",{style:{marginTop:a.space.sm,padding:a.space.md,borderRadius:a.radius.md,border:"1px solid ".concat(a.color.border),background:"#0F172A",color:"#E5E7EB",overflowX:"auto",fontSize:12,lineHeight:1.5},children:JSON.stringify(op,null,2)})]})})]}),(0,n.jsxs)("div",{"data-print":"note",style:{color:"rgba(255,255,255,0.62)",fontSize:12,marginTop:a.space.lg,lineHeight:1.7},children:["注意: NG / UNKNOWN の場合は、入力値の転記ミス、改ざん、鍵ローテーション等が原因になり得ます。",(0,n.jsx)("br",{}),"ここまで整ってると、言い訳じゃなくて「説明」になります（大事）。"]})]})})]})}}},function(o){o.O(0,[847,971,117,744],function(){return o(o.s=2199)}),_N_E=o.O()}]);